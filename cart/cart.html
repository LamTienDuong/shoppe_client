<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body>
    <main class="container">
        <div class="row mt-5">
            <div class="col-md-10">
            </div>
            <div class="col-md-2">
                <button id="btn-history" class="btn btn-success">Lịch sử mua hàng</button>
            </div>
        </div>

        <div id="head-content-cart" class="row mt-5 pt-3 bg-light">
            <div class="col-md-1">
                <!-- <input id="all-checkbox" type="checkbox"> -->
            </div>
            <div class="col-md-3 fw-bold d-flex">
                <p class="mx-2">Sản phẩm</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Đơn giá</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Số lượng</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Số tiền</p>
            </div>
            <div class="col-md-2 fw-bold d-flex ">
                <p class="ms-3">Thao tác</p>
            </div>
        </div>
        <div id="content-cart" class="row py-3 my-2 bg-light"></div>
        <div id="footer-content-cart" class="row py-3 my-2 bg-light">
            <div class="col-md-1">
                <input id="all-checkbox" type="checkbox">
            </div>
            <div class="col-md-3 fw-bold d-flex">
                <label for="all-checkbox" class="mx-2">Chọn tất cả</label>
            </div>
            <div class="col-md-2 fw-bold">

            </div>
            <div class="col-md-2 fw-bold">
                <p>Tổng thanh toán:</p>
            </div>
            <div class="col-md-2 fw-bold">
                <p id="totalPrice"></p>
            </div>
            <div class="col-md-2 fw-bold">
                <button onclick="buyProduct(1)" class="btn btn-primary">Mua hàng</button>
            </div>
        </div>
    </main>


    <!-- Modal xóa sản phẩm -->
    <div class="modal fade" id="modal-delete-cart-product" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Xác nhận xóa sản phẩm</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="display: contents;">Bạn có muốn xóa sản phẩm</p>
                    <p id="name-cart-product-delete" style="display: contents;"></p>
                </div>
                <div class="modal-footer">
                    <form id="form-delete-cart-product" action="#" method="post">
                        <input id="id-cart-product-delete" type="hidden">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Xóa</button>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="/cart/cart.js"></script>
    <script>
        $(document).ready(function () {
            let userId = 1;
            display(userId);

            // nếu all-check box đc chọn thì chọn tất cả các checkbox còn lại
            $('#all-checkbox').click(function () {
                if ($('#all-checkbox').prop('checked')) {
                    $('.item-checkbox').prop('checked', true);
                } else {
                    $('.item-checkbox').prop('checked', false);
                }
                changeCheckbox();
            });

            $('.item-checkbox').change(function () {
                alert('hello')
                // Kiểm tra nếu tất cả các checkbox có class "item-checkbox" đều được chọn
                if ($('.item-checkbox:checked').length === $('.item-checkbox').length) {
                    // Chọn checkbox có id là "all-checkbox"
                    $('#all-checkbox').prop('checked', true);
                } else {
                    // Bỏ chọn checkbox có id là "all"
                    $('#all-checkbox').prop('checked', false);
                }
            });

            // Xóa sản phẩm
            $('#form-delete-cart-product').on('submit', function (event) {
                event.preventDefault();
                let idCartProduct = $('#id-cart-product-delete').val();
                $.ajax({
                    type: 'DELETE',
                    url: `http://localhost:8080/cart/${idCartProduct}`,
                    success: function (data) {
                        $("#modal-delete-cart-product").modal("hide");
                        display(userId);
                    },
                    error: function (error) { }
                });

            });


        });

        
        function check() {
                if ($('.item-checkbox:checked').length === $('.item-checkbox').length) {
                    // Chọn checkbox có id là "all-checkbox"
                    $('#all-checkbox').prop('checked', true);
                
                } else {
                    // Bỏ chọn checkbox có id là "all"
                    $('#all-checkbox').prop('checked', false);
                }
                
            }

        function changeCheckbox() {
            
            let totalPrice = 0;
            $('.item-checkbox').each(function () {
                if ($(this).prop('checked')) {
                    let values = $(this).data('values').split(',');
                    let cartProductId = values[0];
                    let cartProductPrice = values[1];
                    totalPrice += parseInt(cartProductPrice);
                } else {
                    // let check = 0;
                    $('#all-checkbox').prop('checked', false);
                }
            });
            check();
            $('#totalPrice').text(totalPrice.toLocaleString('de-DE'));

        }
    </script>
</body>

</html>