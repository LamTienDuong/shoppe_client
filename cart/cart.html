<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="icon" href="https://shopeeplus.com//upload/images/4321Shopee-logo-512x512.png">
    <link rel="stylesheet" href="../user/css/reset.css">
    <link rel="stylesheet" href="../user/css/style.css">
    <link rel="icon" href="https://shopeeplus.com//upload/images/4321Shopee-logo-512x512.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <header>
        <div class="container">
            <div class="wrapper-1 d-flex justify-content-between">
                <ul class="menu d-flex align-items-center" id="menu">
                    <div id="bars" onclick="hidden1()">
                        <i class="fa-solid fa-bars"></i>
                    </div>

                    <li>
                        <a href="#">Kênh người bán</a>
                    </li>
                    <li>|</li>
                    <li>
                        <a href="#">Trở thành người bán Shoppe</a>
                    </li>
                    <li>|</li>
                    <li>
                        <a href="#">Tải ứng dụng</a>
                    </li>
                    <li>|</li>
                    <li>
                        <a href="#">Kết nối</a>
                        <a href="">
                            <i class="fa-brands fa-facebook"></i>
                        </a>
                        <a href="#">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                    </li>
                </ul>

                <ul class="nav d-flex align-items-center">
                    <li>
                        <a href="#">
                            <i class="fa-regular fa-bell"></i>
                            Thông báo
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-regular fa-circle-question"></i>
                            Hỗ trợ
                        </a>
                    </li>
                    <li>
                        <!-- <a href="register.html">Đăng ký</a> -->
                        <label for="" id="userName"></label>
                    </li>
                    <li>|</li>
                    <li>
                        <!-- <a href="login.html">Đăng nhập</a> -->
                        <button id="logout" class="btn btn-success"><i
                                class="fa-solid fa-right-from-bracket"></i></button>
                    </li>
                </ul>
                <!-- <button style="margin: 30px 0 0 0px" type="button" id="change-dark-mode" class="btn btn-secondary" onclick="changeDarkmode()"><i style="margin-right: 10px;" class="fa-solid fa-sun"></i>Dark mode</button> -->
            </div>

            <div class="wrapper-2 d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div id="logo" class="logo">
                        <a href="#">
                            <img src="../user/img/270213300_352607336253543_2173618840149640549_n.png"
                                alt="logo shoppe">
                        </a>
                    </div>
                    <div class="fs-1 text-light mx-2">|</div>
                    <div class="d-flex mx-2">
                        <div class="fs-1 text-light">Giỏ hàng</div>
                    </div>
                </div>
                <!-- <div class="mx-5 d-flex align-items-center">
                    <div class="fs-2 text-light">Giỏ hàng</div>
                    <div class="fs-2 mx-2 text-light">|</div>
                    <div class="cart" id="cart">
                        <a href="#">
                            <i class="fa-solid fa-cart-shopping fa-2x"></i>
                        </a>
                    </div>
                </div> -->
            </div>
        </div>
    </header>

    <main class="container">
        <div class="row mt-5">
            <div class="col-md-10">
            </div>
            <div class="col-md-2">
                <button id="btn-history" class="btn btn-success">Lịch sử mua hàng</button>
            </div>
        </div>

        <div id="head-content-cart" class="row mt-5 pt-3 bg-light">
            <div class="col-md-1">
                <!-- <input id="all-checkbox" type="checkbox"> -->
            </div>
            <div class="col-md-3 fw-bold d-flex">
                <p class="mx-2">Sản phẩm</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Đơn giá</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Số lượng</p>
            </div>
            <div class="col-md-2 fw-bold d-flex justify-content-center">
                <p>Số tiền</p>
            </div>
            <div class="col-md-2 fw-bold d-flex ">
                <p class="ms-3">Thao tác</p>
            </div>
        </div>
        <div id="content-cart" class="row py-3 my-2 bg-light"></div>
        <div id="footer-content-cart" class="row py-3 my-2 bg-light">
            <div class="col-md-1">
                <input id="all-checkbox" type="checkbox">
            </div>
            <div class="col-md-3 fw-bold d-flex">
                <label for="all-checkbox" class="mx-2">Chọn tất cả</label>
            </div>
            <div class="col-md-2 fw-bold">

            </div>
            <div class="col-md-2 fw-bold">
                <p>Tổng thanh toán:</p>
            </div>
            <div class="col-md-2 fw-bold">
                <p id="totalPrice"></p>
            </div>
            <div class="col-md-2 fw-bold">
                <button onclick="buyProduct(1)" class="btn btn-primary">Mua hàng</button>
            </div>
        </div>
        <!-- Xuất hiện khi giỏ hàng trống -->
        <div id="cart-empty" class="row py-3 my-2 bg-light d-flex justify-content-center">
            <div class="d-flex justify-content-center fs-2">Giỏ hàng của bạn còn trống</div>
            <button id="btn-empty" class="btn text-light" style="background-color: #ee4d2d; width: 100px;">Mua
                ngay</button>
        </div>
    </main>


    <!-- Modal xóa sản phẩm -->
    <div class="modal fade" id="modal-delete-cart-product" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Xác nhận xóa sản phẩm</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="display: contents;">Bạn có muốn xóa sản phẩm</p>
                    <p id="name-cart-product-delete" style="display: contents;"></p>
                </div>
                <div class="modal-footer">
                    <form id="form-delete-cart-product" action="#" method="post">
                        <input id="id-cart-product-delete" type="hidden">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Xóa</button>
                    </form>

                </div>
            </div>
        </div>
    </div>


    <footer class="border border-bottom-0">
        <div class="container">
            <div class="wrapper">
                <div class="row justify-content-between">
                    <div class="col-2">
                        <ul>
                            <li>
                                Chăm sóc khách hàng
                            </li>
                            <li>
                                <a href="#">Trung tâm trợ giúp</a>
                            </li>
                            <li>
                                <a href="#">Shopee Mall</a>
                            </li>
                            <li>
                                <a href="#">Hướng dẫn mua hàng</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-2">
                        <ul>
                            <li>
                                Giới thiệu
                            </li>
                            <li>
                                <a href="#">Giới thiệu</a>
                            </li>
                            <li>
                                <a href="#">Tuyển dụng</a>
                            </li>
                            <li>
                                <a href="#">Điều khoản</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-2">
                        <ul>
                            <li>
                                Theo dõi
                            </li>
                            <li>
                                <i class="fa-brands fa-facebook"></i>
                                <a href="#">
                                    Facebook
                                </a>
                            </li>
                            <li>
                                <i class="fa-brands fa-instagram"></i>
                                <a href="#">
                                    Instagram
                                </a>
                            </li>
                            <li>
                                <i class="fa-brands fa-linkedin"></i>
                                <a href="#">
                                    Linkedin
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-2" id="category-footer">
                        <ul>
                            <li>
                                Danh mục
                            </li>
                            <li>
                                <a href="#">Giày đá bóng</a>
                            </li>
                            <li>
                                <a href="#">Giày leo núi</a>
                            </li>
                            <li>
                                <a href="#">Giày sneakers</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-3">
                        <ul>
                            <li>
                                Vào cửa hàng trên ứng dụng
                            </li>
                            <li>
                                <i class="fa-brands fa-google-play"></i>
                                <a href="#">Google play</a>
                            </li>
                            <li>
                                <i class="fa-brands fa-app-store-ios"></i>
                                <a href="#">App store</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="copyright">
                    <p style="text-align: center;">
                        © 2015 - Bản quyền thuộc về Công ty TNHH Shopee
                    </p>
                </div>
            </div>
        </div>
        </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="/cart/cart.js"></script>
    <script>
        $(document).ready(async function () {
            $('#logo').on('click', function () {
                window.location.href = "http://127.0.0.1:5500/user/html/index.html";
            });

            $('#btn-history').on('click', function () {
                window.location.href = "http://127.0.0.1:5500/order_history/history.html";
            });

            $('#btn-empty').on('click', function () {
                window.location.href = "http://127.0.0.1:5500/user/html/index.html";
            });

            let userId = await getUserId();
            let username = await getUserName();
            $('#userName')
                .text(username)
                .css({
                    "font-size": "16px",
                    "font-weight": "bold",
                    "color": "black"
                });
            

            display(userId);

            // nếu all-check box đc chọn thì chọn tất cả các checkbox còn lại
            $('#all-checkbox').click(function () {
                if ($('#all-checkbox').prop('checked')) {
                    $('.item-checkbox').prop('checked', true);
                } else {
                    $('.item-checkbox').prop('checked', false);
                }
                changeCheckbox();
            });

            $('.item-checkbox').change(function () {
                // Kiểm tra nếu tất cả các checkbox có class "item-checkbox" đều được chọn
                if ($('.item-checkbox:checked').length === $('.item-checkbox').length) {
                    // Chọn checkbox có id là "all-checkbox"
                    $('#all-checkbox').prop('checked', true);
                } else {
                    // Bỏ chọn checkbox có id là "all"
                    $('#all-checkbox').prop('checked', false);
                }
            });

            // Xóa sản phẩm
            $('#form-delete-cart-product').on('submit', function (event) {
                event.preventDefault();
                let idCartProduct = $('#id-cart-product-delete').val();
                $.ajax({
                    headers: {
                        Authorization: "Bearer " + localStorage.getItem("accessToken"), // Đính kèm token trong tiêu đề
                    },
                    type: 'DELETE',
                    url: `http://localhost:8080/cart/${idCartProduct}`,
                    success: function (data) {
                        $("#modal-delete-cart-product").modal("hide");
                        display(userId);
                    },
                    error: function (error) { }
                });

            });


        });


        function check() {
            if ($('.item-checkbox:checked').length === $('.item-checkbox').length) {
                // Chọn checkbox có id là "all-checkbox"
                $('#all-checkbox').prop('checked', true);

            } else {
                // Bỏ chọn checkbox có id là "all"
                $('#all-checkbox').prop('checked', false);
            }

        }

        function changeCheckbox() {
            let totalPrice = 0;
            $('.item-checkbox').each(function () {
                if ($(this).prop('checked')) {
                    let values = $(this).data('values').split(',');
                    let cartProductId = values[0];
                    let cartProductQuantity = values[1];
                    let cartProductPrice = values[2];
                    debugger
                    totalPrice += parseInt(cartProductPrice) * parseInt(cartProductQuantity);
                } else {
                    // let check = 0;
                    $('#all-checkbox').prop('checked', false);
                }
            });
            check();
            $('#totalPrice').text(totalPrice.toLocaleString('de-DE') + 'VNĐ');

        }
    </script>
</body>

</html>